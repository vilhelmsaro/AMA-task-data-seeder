# =============================================================================
# Docker Compose & Infrastructure Configuration
# =============================================================================
#
# Copy this file to .env and customize as needed:
#   cp .env.example .env
#
# All values below are set to their defaults. You can uncomment and modify
# any value to override the default behavior.
#
# =============================================================================

# -----------------------------------------------------------------------------
# Network Configuration (shared with consumer project)
# -----------------------------------------------------------------------------
SEEDER_NETWORK_NAME=seeder-network

# -----------------------------------------------------------------------------
# Redis Master Configuration
# -----------------------------------------------------------------------------
REDIS_MASTER_PORT=6379

# -----------------------------------------------------------------------------
# Redis Replica Configuration
# -----------------------------------------------------------------------------
REDIS_REPLICA_PORT=6380

# -----------------------------------------------------------------------------
# Redis Sentinel Configuration
# -----------------------------------------------------------------------------
# Internal port used by all Sentinels (must be the same for all)
SENTINEL_PORT=26379

# External ports for each Sentinel (exposed to host)
SENTINEL_1_PORT=26379
SENTINEL_2_PORT=26380
SENTINEL_3_PORT=26381

# Sentinel cluster configuration
# Quorum: Minimum number of Sentinels that must agree to trigger a failover
SENTINEL_QUORUM=2

# Time in milliseconds before a master is considered down
SENTINEL_DOWN_AFTER_MS=1000

# Timeout in milliseconds for failover operations
SENTINEL_FAILOVER_TIMEOUT_MS=3000

# Number of replicas that can be reconfigured simultaneously during failover
SENTINEL_PARALLEL_SYNCS=1

# -----------------------------------------------------------------------------
# Redis Health Check Configuration
# -----------------------------------------------------------------------------
REDIS_HEALTHCHECK_INTERVAL=5s
REDIS_HEALTHCHECK_TIMEOUT=3s
REDIS_HEALTHCHECK_RETRIES=5

# -----------------------------------------------------------------------------
# Volume Paths (for bind mounts)
# -----------------------------------------------------------------------------
# Host paths (relative to docker-compose.yml location or absolute paths)
DATA_VOLUME_PATH=./data
LOGS_VOLUME_PATH=./logs

# Container paths (absolute paths inside containers)
SQLITE_DATA_DIR=/app/data
LOGS_DIR=/app/logs

# =============================================================================
# Application Configuration
# =============================================================================

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------
PORT=3001

# -----------------------------------------------------------------------------
# Redis Connection Configuration
# -----------------------------------------------------------------------------
# Set to 'true' to use Redis Sentinel (recommended for production with failover)
# Set to 'false' to use direct Redis connection (for development/testing)
REDIS_USE_SENTINEL=true

# Comma-separated list of Sentinel hosts
# Format: host1:port1,host2:port2,host3:port3
# Default matches the Sentinel container names and default ports
REDIS_SENTINEL_HOSTS=redis-sentinel-1:26379,redis-sentinel-2:26379,redis-sentinel-3:26379

# Master name for Sentinel (must match across all Sentinels)
REDIS_SENTINEL_MASTER_NAME=mymaster

# Fallback Direct Redis Connection (used when REDIS_USE_SENTINEL=false)
REDIS_HOST=redis-master
# Note: REDIS_PORT will automatically use REDIS_MASTER_PORT value

# -----------------------------------------------------------------------------
# SQLite Configuration
# -----------------------------------------------------------------------------
SQLITE_DB_PATH=/app/data/cars.db

# -----------------------------------------------------------------------------
# Circuit Breaker Configuration
# -----------------------------------------------------------------------------
# Number of failures before opening the circuit breaker
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5

# Cooldown period in milliseconds before attempting to close the circuit breaker
CIRCUIT_BREAKER_COOLDOWN_MS=2000

# -----------------------------------------------------------------------------
# Recovery Configuration
# -----------------------------------------------------------------------------
# Number of entries to recover per chunk
RECOVERY_CHUNK_SIZE=50

# Cooldown period in milliseconds between recovery attempts
RECOVERY_COOLDOWN_MS=10000

# Interval in milliseconds for checking if recovery should proceed
RECOVERY_CHECK_INTERVAL_MS=5000

# -----------------------------------------------------------------------------
# Car Generation Configuration
# -----------------------------------------------------------------------------
# Interval in milliseconds between car generation (~2000 cars/minute with default)
CAR_GENERATION_INTERVAL_MS=30

# -----------------------------------------------------------------------------
# Metrics Configuration
# -----------------------------------------------------------------------------
METRICS_LOG_DIR=/app/logs

# NOTE: This network name is shared with the consumer project.
# Both projects must use the same network name (default: seeder-network)
# to communicate. The explicit network name prevents Docker Compose from
# automatically prefixing it with the project directory name.
